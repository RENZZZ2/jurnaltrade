<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trading Journal Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Tambahan PapaParse supaya import CSV jalan -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: white;
      background: url('img/bg.jpg') no-repeat center center fixed;
      background-size: cover;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: -1;
    }

    .container {
      padding: 20px;
      text-align: center;
    }

    h1 {
      margin-bottom: 20px;
      text-shadow: 0px 0px 10px #fff;
      animation: fadeIn 2s ease;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
      min-width: 150px;
      box-shadow: 0px 0px 15px rgba(255,255,255,0.3);
      transition: transform 0.3s;
    }
    .card:hover {
      transform: scale(1.05);
    }

    form {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    input, button {
      padding: 10px;
      border: none;
      border-radius: 8px;
      outline: none;
    }
    input {
      flex: 1 1 200px;
    }
    button {
      background: black;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: white;
      color: black;
      box-shadow: 0px 0px 15px white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      animation: fadeIn 2s ease;
    }
    th, td {
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.3);
    }
    th {
      background: rgba(255,255,255,0.2);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }

    .charts {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .chart-container {
      width: 400px;
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Trading Journal Dashboard</h1>

    <div class="stats">
      <div class="card"><h2 id="currentModal">Modal: $0</h2></div>
      <div class="card"><h2 id="totalPL">Total P/L: $0</h2></div>
      <div class="card"><h2 id="winrate">Winrate: 0%</h2></div>
    </div>

    <form id="tradeForm">
      <input type="date" id="tanggal" required>
      <input type="number" id="modal" placeholder="Modal Awal" required>
      <input type="text" id="before" placeholder="Before Trade (link)">
      <input type="text" id="after" placeholder="After Trade (link)">
      <input type="text" id="alasan" placeholder="Alasan Trade">
      <input type="text" id="pair" placeholder="Pair">
      <input type="text" id="sltp" placeholder="SL/TP">
      <input type="text" id="profitLoss" placeholder="+1000 / -500">
      <button type="submit">Tambah Trade</button>
      <button type="button" onclick="exportCSV()">Export CSV</button>
      <input type="file" id="importFile" onchange="importCSV(event)">
      <button type="button" onclick="clearAll()">üóë Clear All</button>
    </form>

    <table id="tradeTable">
      <thead>
        <tr>
          <th>No</th>
          <th>Tanggal</th>
          <th>Modal</th>
          <th>Before</th>
          <th>After</th>
          <th>Alasan</th>
          <th>Pair</th>
          <th>SL/TP</th>
          <th>P/L</th>
          <th>‚ùå</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="charts">
      <div class="chart-container">
        <canvas id="winrateChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="growthChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    let trades = [];
    let currentModal = 0;
    let wins = 0, losses = 0;

    const tradeForm = document.getElementById("tradeForm");
    const tableBody = document.querySelector("#tradeTable tbody");
    const modalDisplay = document.getElementById("currentModal");
    const plDisplay = document.getElementById("totalPL");
    const winrateDisplay = document.getElementById("winrate");

    const ctx1 = document.getElementById("winrateChart");
    const ctx2 = document.getElementById("growthChart");

    const winrateChart = new Chart(ctx1, {
      type: 'doughnut',
      data: {
        labels: ['Win', 'Loss'],
        datasets: [{
          data: [0, 0],
          backgroundColor: ['#00ff99', '#ff4444']
        }]
      },
      options: { responsive: true, plugins: { legend: { labels: { color: "white" }}}}
    });

    const growthChart = new Chart(ctx2, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Modal Growth',
          data: [],
          borderColor: '#00aaff',
          backgroundColor: 'rgba(0,170,255,0.3)',
          fill: true,
          tension: 0.3
        }]
      },
      options: { responsive: true, plugins: { legend: { labels: { color: "white" } } },
        scales: { x: { ticks: { color: "white" } }, y: { ticks: { color: "white" }}}}
    });

    function renderTable() {
      tableBody.innerHTML = "";
      trades.forEach((t, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${i+1}</td>
          <td>${t.tanggal}</td>
          <td>$${t.modal}</td>
          <td><a href="${t.before}" target="_blank">Link</a></td>
          <td><a href="${t.after}" target="_blank">Link</a></td>
          <td>${t.alasan}</td>
          <td>${t.pair}</td>
          <td>${t.sltp}</td>
          <td style="color:${t.pl>=0?'#00ff99':'#ff4444'}">${t.pl}</td>
          <td><button onclick="deleteTrade(${i})">‚ùå</button></td>`;
        tableBody.appendChild(row);
      });

      // Statistik update
      const totalPL = trades.reduce((acc, t) => acc + t.pl, 0);
      const winrate = ((wins / (wins + losses)) * 100).toFixed(1);
      modalDisplay.innerText = `Modal: $${currentModal}`;
      plDisplay.innerText = `Total P/L: $${totalPL}`;
      winrateDisplay.innerText = `Winrate: ${isNaN(winrate)?0:winrate}%`;

      // Update chart
      winrateChart.data.datasets[0].data = [wins, losses];
      winrateChart.update();

      growthChart.data.labels = trades.map(t=>t.tanggal);
      growthChart.data.datasets[0].data = trades.map(t=>t.modal + t.pl);
      growthChart.update();
    }

    function deleteTrade(index) {
      const plValue = trades[index].pl;
      if(plValue >=0) wins--;
      else losses--;
      trades.splice(index, 1);
      currentModal = trades.length ? trades[trades.length-1].modal + trades[trades.length-1].pl : 0;
      renderTable();
    }

    tradeForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const tanggal = document.getElementById("tanggal").value;
      let modal = parseFloat(document.getElementById("modal").value);
      const before = document.getElementById("before").value;
      const after = document.getElementById("after").value;
      const alasan = document.getElementById("alasan").value;
      const pair = document.getElementById("pair").value;
      const sltp = document.getElementById("sltp").value;
      const plInput = document.getElementById("profitLoss").value.trim();

      let pl = 0;
      if(plInput.startsWith("+")) { pl = parseFloat(plInput.slice(1)); wins++; }
      else if(plInput.startsWith("-")) { pl = parseFloat(plInput.slice(1)) * -1; losses++; }

      currentModal = modal + pl;
      trades.push({ tanggal, modal, before, after, alasan, pair, sltp, pl });

      renderTable();
      tradeForm.reset();
    });

    function clearAll() {
      if (confirm("Yakin hapus semua data?")) {
        trades = [];
        wins = 0; losses = 0;
        currentModal = 0;
        renderTable();
      }
    }

    function exportCSV() {
      let csv = "No,Tanggal,Modal,Before,After,Alasan,Pair,SL/TP,P/L\n";
      trades.forEach((t,i)=>{
        csv += `${i+1},${t.tanggal},${t.modal},${t.before},${t.after},${t.alasan},${t.pair},${t.sltp},${t.pl}\n`;
      });
      const blob = new Blob([csv], {type: 'text/csv'});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "trading_journal.csv";
      link.click();
    }

    function importCSV(event) {
      const file = event.target.files[0];
      Papa.parse(file, {
        header: true,
        complete: (results) => {
          trades = results.data.filter(r=>r.tanggal).map(r=>{
            const pl = parseFloat(r['P/L']) || 0;
            if(pl>=0) wins++; else losses++;
            return {
              tanggal: r['Tanggal'],
              modal: parseFloat(r['Modal']) || 0,
              before: r['Before'] || '',
              after: r['After'] || '',
              alasan: r['Alasan'] || '',
              pair: r['Pair'] || '',
              sltp: r['SL/TP'] || '',
              pl
            };
          });
          currentModal = trades.length ? trades[trades.length-1].modal + trades[trades.length-1].pl : 0;
          renderTable();
        }
      });
    }
  </script>
</body>
</html>
